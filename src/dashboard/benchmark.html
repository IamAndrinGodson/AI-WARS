<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Benchmarks - Threat Detection System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-dark: #0a0d14;
            --bg-panel: #12161f;
            --bg-card: #1a1e2e;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --accent-primary: #3b82f6;
            --accent-danger: #ef4444;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-purple: #a855f7;
            --border-color: #2d3748;
            --glow-cyan: rgba(34, 211, 238, 0.3);
            --glow-purple: rgba(168, 85, 247, 0.3);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #0f172a 100%);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .title h1 {
            margin: 0;
            font-size: 1.6rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .title h1 i {
            color: var(--accent-primary);
            filter: drop-shadow(0 0 8px var(--accent-primary));
        }

        .nav-btn {
            background: linear-gradient(135deg, var(--bg-panel) 0%, var(--bg-card) 100%);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-btn:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px var(--glow-cyan);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .grid-full {
            grid-template-columns: 1fr;
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .card {
            background: linear-gradient(145deg, var(--bg-panel) 0%, var(--bg-card) 100%);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .card:hover {
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 4px 30px rgba(59, 130, 246, 0.1);
        }

        .card-header {
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-header i {
            color: var(--accent-primary);
        }

        .span-2 {
            grid-column: span 2;
        }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .summary-card {
            background: linear-gradient(145deg, var(--bg-panel) 0%, var(--bg-card) 100%);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .summary-card .value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .summary-card .label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .value-high {
            color: var(--accent-success);
        }

        .value-med {
            color: var(--accent-warning);
        }

        .value-low {
            color: var(--accent-danger);
        }

        /* Quality Badge */
        .quality-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .quality-excellent {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.4);
        }

        .quality-good {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.4);
        }

        .quality-fair {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.4);
        }

        .quality-poor {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.4);
        }

        /* Model Cards */
        .model-card {
            background: linear-gradient(145deg, var(--bg-panel) 0%, var(--bg-card) 100%);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
        }

        .model-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .model-name {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .metric-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 14px;
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-size: 1.4rem;
            font-weight: 700;
        }

        /* Progress bars */
        .progress-container {
            margin-top: 8px;
        }

        .progress-bar {
            height: 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .progress-fill.high {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .progress-fill.med {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        .progress-fill.low {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            text-align: left;
            padding: 16px 12px;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: var(--text-primary);
            font-weight: 500;
        }

        tbody tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        .score-high {
            color: var(--accent-success);
        }

        .score-med {
            color: var(--accent-warning);
        }

        .score-low {
            color: var(--accent-danger);
        }

        /* Algorithm Info */
        .algo-info {
            background: rgba(59, 130, 246, 0.1);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            margin-bottom: 20px;
        }

        .algo-info h4 {
            margin: 0 0 12px 0;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .algo-info p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Analysis Section */
        .analysis-section {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .analysis-section h3 {
            margin: 0 0 16px 0;
            color: var(--accent-purple);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-item {
            margin-bottom: 16px;
            padding-left: 20px;
            border-left: 3px solid var(--accent-primary);
        }

        .analysis-item:last-child {
            margin-bottom: 0;
        }

        .analysis-item strong {
            color: var(--accent-primary);
        }

        /* Loading State */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px;
            color: var(--text-secondary);
        }

        .loading i {
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* No Data */
        .no-data {
            text-align: center;
            padding: 60px;
            color: var(--text-secondary);
        }

        @media (max-width: 900px) {
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .span-2 {
                grid-column: span 1;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="title">
                <h1><i class="fas fa-chart-bar"></i> Model Performance Benchmarks</h1>
            </div>
            <a href="/dashboard/" class="nav-btn"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
        </header>

        <!-- Summary Cards -->
        <div class="summary-grid" id="summary-cards">
            <div class="summary-card">
                <div class="value" id="total-models">-</div>
                <div class="label">Models Tested</div>
            </div>
            <div class="summary-card">
                <div class="value" id="best-accuracy">-</div>
                <div class="label">Best Accuracy</div>
            </div>
            <div class="summary-card">
                <div class="value" id="best-f1">-</div>
                <div class="label">Best F1 Score</div>
            </div>
            <div class="summary-card">
                <div class="value" id="avg-latency">-</div>
                <div class="label">Avg Latency</div>
            </div>
        </div>

        <!-- Algorithm Info -->
        <div class="algo-info">
            <h4><i class="fas fa-cogs"></i> Algorithm Details</h4>
            <p>
                All models use <strong>Isolation Forest</strong> for anomaly detection. This unsupervised algorithm
                isolates anomalies by randomly selecting features and splitting values.
                Models are trained on network flow data with features including packet counts, byte sizes, flow
                duration, and port statistics.
            </p>
        </div>

        <!-- Charts -->
        <div class="grid grid-2">
            <div class="card">
                <div class="card-header"><i class="fas fa-chart-line"></i> Accuracy & F1 Comparison</div>
                <canvas id="benchmarkChart" height="200"></canvas>
            </div>
            <div class="card">
                <div class="card-header"><i class="fas fa-bullseye"></i> Precision vs Recall</div>
                <canvas id="prChart" height="200"></canvas>
            </div>
        </div>

        <!-- Model Cards -->
        <div class="card-header" style="margin: 24px 0 16px 0;"><i class="fas fa-cubes"></i> Individual Model
            Performance</div>
        <div class="grid" id="model-cards">
            <div class="loading"><i class="fas fa-spinner"></i> Loading benchmark data...</div>
        </div>

        <!-- Detailed Table -->
        <div class="card" style="margin-top: 24px;">
            <div class="card-header"><i class="fas fa-table"></i> Detailed Metrics</div>
            <div id="table-container">
                <div class="loading"><i class="fas fa-spinner"></i> Loading...</div>
            </div>
        </div>

        <!-- Analysis -->
        <div class="analysis-section" style="margin-top: 24px;">
            <h3><i class="fas fa-brain"></i> Model Training Analysis</h3>
            <div id="analysis-content">
                <div class="analysis-item">
                    <strong>Accuracy:</strong> Measures overall correct predictions. Higher is better, but can be
                    misleading with imbalanced data.
                </div>
                <div class="analysis-item">
                    <strong>Precision:</strong> Of all predicted threats, how many were actual threats. High precision
                    means fewer false alarms.
                </div>
                <div class="analysis-item">
                    <strong>Recall:</strong> Of all actual threats, how many were detected. <strong>Critical for
                        security</strong> - low recall means missing real threats.
                </div>
                <div class="analysis-item">
                    <strong>F1 Score:</strong> Harmonic mean of precision and recall. Best single metric for model
                    quality.
                </div>
            </div>
        </div>
    </div>

    <script>
        let benchmarkData = [];

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/benchmark/results');
                benchmarkData = await response.json();

                if (!benchmarkData || benchmarkData.length === 0) {
                    showNoData();
                    return;
                }

                renderSummary(benchmarkData);
                renderModelCards(benchmarkData);
                renderTable(benchmarkData);
                renderCharts(benchmarkData);
                updateAnalysis(benchmarkData);
            } catch (e) {
                console.error("Error loading benchmarks:", e);
                document.getElementById('table-container').innerHTML = '<div class="no-data">Failed to load benchmark data. Run benchmarks first.</div>';
                document.getElementById('model-cards').innerHTML = '<div class="no-data">No data available</div>';
            }
        });

        function showNoData() {
            document.getElementById('table-container').innerHTML = '<div class="no-data">No benchmark data available. Run the benchmark script first.</div>';
            document.getElementById('model-cards').innerHTML = '<div class="no-data">No models benchmarked yet.</div>';
        }

        function getQuality(f1) {
            if (f1 >= 0.8) return { class: 'quality-excellent', text: 'Excellent' };
            if (f1 >= 0.6) return { class: 'quality-good', text: 'Good' };
            if (f1 >= 0.4) return { class: 'quality-fair', text: 'Fair' };
            return { class: 'quality-poor', text: 'Poor' };
        }

        function getColor(score) {
            if (score >= 0.7) return 'high';
            if (score >= 0.4) return 'med';
            return 'low';
        }

        function getScoreClass(score) {
            if (score >= 0.7) return 'score-high';
            if (score >= 0.4) return 'score-med';
            return 'score-low';
        }

        function renderSummary(data) {
            document.getElementById('total-models').textContent = data.length;

            const bestAcc = Math.max(...data.map(d => d.Accuracy));
            document.getElementById('best-accuracy').textContent = (bestAcc * 100).toFixed(1) + '%';
            document.getElementById('best-accuracy').className = 'value value-' + getColor(bestAcc);

            const bestF1 = Math.max(...data.map(d => d['F1 Score']));
            document.getElementById('best-f1').textContent = (bestF1 * 100).toFixed(1) + '%';
            document.getElementById('best-f1').className = 'value value-' + getColor(bestF1);

            const avgLat = data.reduce((sum, d) => sum + d['Latency (s)'], 0) / data.length;
            document.getElementById('avg-latency').textContent = avgLat.toFixed(2) + 's';
        }

        function renderModelCards(data) {
            let html = '';

            data.forEach(row => {
                const quality = getQuality(row['F1 Score']);

                html += `
                <div class="model-card">
                    <div class="model-header">
                        <span class="model-name">${row.Model}</span>
                        <span class="quality-badge ${quality.class}"><i class="fas fa-circle"></i> ${quality.text}</span>
                    </div>
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <div class="metric-label">Accuracy</div>
                            <div class="metric-value ${getScoreClass(row.Accuracy)}">${(row.Accuracy * 100).toFixed(1)}%</div>
                            <div class="progress-container">
                                <div class="progress-bar"><div class="progress-fill ${getColor(row.Accuracy)}" style="width: ${row.Accuracy * 100}%"></div></div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Precision</div>
                            <div class="metric-value ${getScoreClass(row.Precision)}">${(row.Precision * 100).toFixed(1)}%</div>
                            <div class="progress-container">
                                <div class="progress-bar"><div class="progress-fill ${getColor(row.Precision)}" style="width: ${row.Precision * 100}%"></div></div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Recall</div>
                            <div class="metric-value ${getScoreClass(row.Recall)}">${(row.Recall * 100).toFixed(1)}%</div>
                            <div class="progress-container">
                                <div class="progress-bar"><div class="progress-fill ${getColor(row.Recall)}" style="width: ${row.Recall * 100}%"></div></div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">F1 Score</div>
                            <div class="metric-value ${getScoreClass(row['F1 Score'])}">${(row['F1 Score'] * 100).toFixed(1)}%</div>
                            <div class="progress-container">
                                <div class="progress-bar"><div class="progress-fill ${getColor(row['F1 Score'])}" style="width: ${row['F1 Score'] * 100}%"></div></div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; color: var(--text-secondary); font-size: 0.85rem;">
                        <span><i class="fas fa-clock"></i> ${row['Latency (s)'].toFixed(2)}s latency</span>
                        <span><i class="fas fa-database"></i> ${row.Samples.toLocaleString()} samples</span>
                    </div>
                </div>`;
            });

            document.getElementById('model-cards').innerHTML = html;
        }

        function renderTable(data) {
            let html = `<table><thead><tr>
                <th>Model</th>
                <th>Accuracy</th>
                <th>Precision</th>
                <th>Recall</th>
                <th>F1 Score</th>
                <th>Latency</th>
                <th>Samples</th>
                <th>Quality</th>
            </tr></thead><tbody>`;

            data.forEach(row => {
                const quality = getQuality(row['F1 Score']);
                html += `<tr>
                    <td><strong>${row.Model}</strong></td>
                    <td class="${getScoreClass(row.Accuracy)}">${(row.Accuracy * 100).toFixed(1)}%</td>
                    <td class="${getScoreClass(row.Precision)}">${(row.Precision * 100).toFixed(1)}%</td>
                    <td class="${getScoreClass(row.Recall)}">${(row.Recall * 100).toFixed(1)}%</td>
                    <td class="${getScoreClass(row['F1 Score'])}">${(row['F1 Score'] * 100).toFixed(1)}%</td>
                    <td>${row['Latency (s)'].toFixed(3)}s</td>
                    <td>${row.Samples.toLocaleString()}</td>
                    <td><span class="quality-badge ${quality.class}">${quality.text}</span></td>
                </tr>`;
            });

            html += '</tbody></table>';
            document.getElementById('table-container').innerHTML = html;
        }

        function renderCharts(data) {
            if (!data || data.length === 0) return;

            const labels = data.map(d => d.Model);

            // Bar Chart - Accuracy & F1
            const ctx1 = document.getElementById('benchmarkChart').getContext('2d');
            new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Accuracy',
                            data: data.map(d => d.Accuracy),
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: '#3b82f6',
                            borderWidth: 2,
                            borderRadius: 6
                        },
                        {
                            label: 'F1 Score',
                            data: data.map(d => d['F1 Score']),
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: '#10b981',
                            borderWidth: 2,
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1.0,
                            grid: { color: 'rgba(45, 55, 72, 0.5)' },
                            ticks: { color: '#94a3b8', callback: v => (v * 100) + '%' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#e2e8f0' } }
                    }
                }
            });

            // Scatter Chart - Precision vs Recall
            const ctx2 = document.getElementById('prChart').getContext('2d');
            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#a855f7', '#ef4444'];

            new Chart(ctx2, {
                type: 'scatter',
                data: {
                    datasets: data.map((d, i) => ({
                        label: d.Model,
                        data: [{ x: d.Recall, y: d.Precision }],
                        backgroundColor: colors[i % colors.length],
                        borderColor: colors[i % colors.length],
                        pointRadius: 12,
                        pointHoverRadius: 15
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        x: {
                            title: { display: true, text: 'Recall', color: '#94a3b8' },
                            min: 0, max: 1,
                            grid: { color: 'rgba(45, 55, 72, 0.5)' },
                            ticks: { color: '#94a3b8', callback: v => (v * 100) + '%' }
                        },
                        y: {
                            title: { display: true, text: 'Precision', color: '#94a3b8' },
                            min: 0, max: 1,
                            grid: { color: 'rgba(45, 55, 72, 0.5)' },
                            ticks: { color: '#94a3b8', callback: v => (v * 100) + '%' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#e2e8f0' } },
                        tooltip: {
                            callbacks: {
                                label: ctx => `${ctx.dataset.label}: P=${(ctx.parsed.y * 100).toFixed(1)}%, R=${(ctx.parsed.x * 100).toFixed(1)}%`
                            }
                        }
                    }
                }
            });
        }

        function updateAnalysis(data) {
            // Find best/worst models
            const sortedByF1 = [...data].sort((a, b) => b['F1 Score'] - a['F1 Score']);
            const best = sortedByF1[0];
            const worst = sortedByF1[sortedByF1.length - 1];

            const avgRecall = data.reduce((sum, d) => sum + d.Recall, 0) / data.length;
            const avgF1 = data.reduce((sum, d) => sum + d['F1 Score'], 0) / data.length;

            let analysisHtml = `
                <div class="analysis-item">
                    <strong>Best Performing Model:</strong> ${best.Model} with F1 Score of ${(best['F1 Score'] * 100).toFixed(1)}%
                </div>
                <div class="analysis-item">
                    <strong>Average Recall:</strong> ${(avgRecall * 100).toFixed(1)}% - ${avgRecall < 0.5 ? '<span style="color:#ef4444">Low recall indicates missed threat detections. Consider retraining with more balanced data.</span>' : 'Acceptable threat detection rate.'}
                </div>
                <div class="analysis-item">
                    <strong>Overall Assessment:</strong> ${avgF1 < 0.4 ? '<span style="color:#ef4444">Models need significant improvement. Consider: (1) More training data, (2) Better feature engineering, (3) Hyperparameter tuning, (4) Alternative algorithms like deep learning autoencoders.</span>' : avgF1 < 0.7 ? '<span style="color:#f59e0b">Models show moderate performance. Fine-tuning recommended.</span>' : '<span style="color:#10b981">Models are performing well.</span>'}
                </div>
            `;

            document.getElementById('analysis-content').innerHTML = analysisHtml;
        }
    </script>
</body>

</html>